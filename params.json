{"name":"Tweeather","tagline":"ML project that correlates Twitter sentiment to European weather.","body":"# Tweeather\r\n\r\nTweeather is a Machine Learning project that correlates Twitter sentiment to European weather.\r\n\r\nI was inspired by a study where user behaviour on Twitter was used to build a predictive model of income: [Studying\r\nUser Income through Language, Behaviour and Affect in Social Media][1]. I decided it was the perfect opportunity to venture into the world of Big Data and so I learned Spark and Hadoop.\r\n\r\n## Table of Contents\r\n\r\n- [Requirements](#requirements)\r\n- [Setup](#setup)\r\n\t- [Configuration](#configuration)\r\n\t- [Env vars](#env-vars)\r\n\t- [System properties](#system-properties)\r\n\t- [Submit tasks](#submit-tasks)\r\n- [Scripts](#scripts)\r\n\t- [1. *Sentiment140* scripts](#1-sentiment140-scripts)\r\n\t- [2. *Emo* scripts](#2-emo-scripts)\r\n\t- [3. *Fire* scripts](#3-fire-scripts)\r\n- [Conclusion](#conclusion)\r\n- [Tips](#tips)\r\n- [Suggestions](#suggestions)\r\n- [Downloads](#downloads)\r\n\r\n## Requirements\r\n\r\nYou need these tools to be able to run the project:\r\n\r\n- Java 1.7+\r\n- [scala-sbt][7]\r\n\r\nAnd these clusters:\r\n\r\n- [Apache Spark 1.6][6] (required for everything)\r\n- [HDFS][8] (required only for multi-machine Spark clusters)\r\n\r\nAnd the following hardware:\r\n\r\n- one or more machines\r\n\t- preferably a single, powerful one so you don't need Hadoop\r\n- at least 16GB of RAM\r\n\t- it should work with less, but make sure you edit the `executorHighMem` size in `SparkSubmit.scala` – see [Setup](#setup)\r\n- at least 8 logical cores\r\n\t- it should work with less, but the more you have the better/faster scripts will run\r\n\t- to run the Collector scripts, you need to have at least `<number of Twitter apps> + 1` cores\r\n\r\n## Setup\r\n\r\n### Configuration\r\n\r\nThe project has 2 configuration files:\r\n\r\n- `src/main/resources/com/aluxian/tweeather/res/twitter.properties`\r\n\t- used to provide Twitter credentials for the Collector scripts\r\n- `src/main/resources/com/aluxian/tweeather/res/log4j.properties`\r\n\t- used to configure logging\r\n\r\nMake sure you copy and configure these before running the scripts:\r\n\r\n```\r\n$ cp src/main/resources/com/aluxian/tweeather/res/log4j-template.properties \\\r\n\tsrc/main/resources/com/aluxian/tweeather/res/log4j.properties\r\n$ cp src/main/resources/com/aluxian/tweeather/res/twitter-template.properties \\\r\n\tsrc/main/resources/com/aluxian/tweeather/res/twitter.properties\r\n```\r\n\r\n### Env vars\r\n\r\nMake sure you set these up before running a script:\r\n\r\n- `TW_SPARK_MASTER`\r\n\t- a url to a Spark master to connect to\r\n\t- if not specified, scripts will run on `local[*]`\r\n\t- by default, scripts will run in `client` deploy mode\r\n\r\n### System properties\r\n\r\nTweeather supports the following custom system properties:\r\n\r\n- `tw.streaming.timeout`\r\n\t- the period, in seconds, after which streaming should stop\r\n\t- default: *unlimited*\r\n- `tw.streaming.interval`\r\n\t- the duration, in seconds, for each streaming batch\r\n\t- default: *5 minutes*\r\n\r\n### Submit tasks\r\n\r\nIf your Spark cluster doesn't have at least 14GB of RAM, edit `executorHighMem` in `project/SparkSubmit.scala`.\r\n\r\n## Scripts\r\n\r\nThe project has 3 sets of scripts.\r\n\r\n### 1. *Sentiment140* scripts\r\n\r\nI used these scripts to train a naive Bayes sentiment analyser with the [Sentiment140][2] dataset. Nothing fancy here. The resulting model has an accuracy of 80%.\r\n\r\n#### Processing\r\n\r\nThe same processing steps were taken as for the [*Emo* scripts](#2-emo-scripts).\r\n\r\n#### Running\r\n\r\nTo run the experiment:\r\n\r\n```\r\n# Download the datasets\r\n$ sbt submit-Sentiment140Downloader\r\n\r\n# Parse the datasets\r\n$ sbt submit-Sentiment140Parser\r\n\r\n# Train the sentiment analyser\r\n$ sbt submit-Sentiment140Trainer\r\n\r\n# Test the analyser\r\n$ sbt submit-Sentiment140Repl\r\n```\r\n\r\n### Example\r\n\r\nHere's an example of prediction done on the Sentiment140 test dataset:\r\n\r\n```\r\n|actual|predicted         |raw_text                                                                                                                                 |\r\n|1.0   |0.9906351122104053|Obama's got JOKES!! haha just got to watch a bit of his after dinner speech from last night... i'm in love with mr. president ;)         |\r\n|0.0   |0.3665541605686164|LEbron james got in a car accident i guess..just heard it on evening news...wow i cant believe it..will he be ok ? http://twtad.com/69750|\r\n|1.0   |0.4466193778555213|is it me or is this the best the playoffs have been in years oh yea lebron and melo in the finals                                        |\r\n|1.0   |0.5779917305269712|@khalid0456 No, Lebron is the best                                                                                                       |\r\n|1.0   |0.7991567513906502|@the_real_usher LeBron is cool.  I like his personality...he has good character.                                                         |\r\n|1.0   |0.5027089309407685|Watching Lebron highlights. Damn that niggas good                                                                                        |\r\n|1.0   |0.1677252771491839|@Lou911 Lebron is MURDERING shit.                                                                                                        |\r\n|1.0   |0.2183415128849378|@uscsports21 LeBron is a monsta and he is only 24. SMH The world ain't ready.                                                            |\r\n|1.0   |0.9184651111073650|@cthagod when Lebron is done in the NBA he will probably be greater than Kobe. Like u said Kobe is good but there alot of 'good' players.|\r\n|1.0   |0.6414672757144448|KOBE IS GOOD BT LEBRON HAS MY VOTE                                                                                                       |\r\n|0.0   |0.7777182849481007|Kobe is the best in the world not lebron .                                                                                               |\r\n|1.0   |0.5581821154365963|@asherroth World Cup 2010 Access?? Damn, that's a good look!                                                                             |\r\n```\r\n\r\nYou can download a file with more examples from the [downloads section](#downloads).\r\n\r\n### 2. *Emo* scripts\r\n\r\nI used these scripts to train a naive Bayes sentiment analyser with tweets collected by myself. The resulting model had an accuracy of 75% and is available for download in the [downloads section](#downloads).\r\n\r\n#### Collection\r\n\r\nFor collecting the tweets, I used [Twitter's Streaming API][3] with multiple apps configured. The average throughput was of 325 tweets/sec and I collected over 100M tweets in 4 days. However, after removing all the duplicates, only 8.4M remained.\r\n\r\nThe stream of tweets I received from the Twitter API was filtered by emoji characters. Tweets that contained positive emojis like :grin: were classified as positive, and tweets that contained negative emojis like :cry: were classified as negative. Tweets that contained both types of emojis were excluded.\r\n\r\nThis method allowed me to gather a fairly large dataset of labelled tweets, while the accuracy of the model didn't seem to suffer.\r\n\r\n#### Processing\r\n\r\nBefore training the analyser, the tweets were pre-processed:\r\n\r\n- the feature space was reduced\r\n  - urls were replaced with `URL`\r\n  - `@username` mentions were replaced with `USERNAME`\r\n  - repeated letters were replaced with just 2 occurrences of the letter\r\n- text was sanitized\r\n  - punctuation was removed\r\n  - multiple white spaces were replaced with just one\r\n- stop words like \"not\", \"is\", \"less\", and \"or\" were removed\r\n\r\n#### Training\r\n\r\nI used 90% of the tweets for training and the remaining 10% for testing.\r\n\r\n#### Running\r\n\r\nTo run the experiment:\r\n\r\n```\r\n# Collect tweets; leave this running for a few hours\r\n$ sbt submit-TwitterHoseEmoCollector\r\n\r\n# Parse the collected tweets\r\n$ sbt submit-TwitterHoseEmoParser\r\n\r\n# Train the sentiment analyser\r\n$ sbt submit-TwitterHoseEmoTrainer\r\n\r\n# Test the analyser\r\n$ sbt submit-TwitterHoseEmoRepl\r\n```\r\n\r\n#### Screenshot\r\n\r\nHere's a screenshot of my collector running for almost 4 days.\r\n\r\n![Emo Collector](https://raw.githubusercontent.com/Aluxian/Tweeather/master/docs/ss-emo-collector.png)\r\n\r\n#### Example\r\n\r\nHere's an example of some tweets and their predicted polarity:\r\n\r\n```\r\n|lat       |lon       |polarity          |raw_text\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.5220677359995693|@onikashabibi IM HOWLING\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.7705892813840320|am i the only one attracted to Hyde\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.6705864102035392|nicki and gaga better release a track one day or imma cut a bitch\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.0851292224547309|@elissamk_ yeah I don't know.  Maybe schedule or major conflict\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.4380899284568244|@TWlSTEDFANTASY by the show? it had worse seasons.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.8572554520257938|@ElieRustom well deserved.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.0683891442591605|Wanted to wake up at 8 am for a morning jog but here I am at 3:37 am scanning Twitter for what I've missed\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.5289639040745624|@ayaalhakim_ @_NiZS lol same  between its potential and reality. I think its almost inescapably useless. No matter how relevant the content.|\r\n|33.8733655|35.8495145|0.0462046697117165|You get a temporary high as you watch life pass you by Every single day you want to cry Can we wish the tears a fond goodbye #TroubledSoul\t|\r\n|33.8733655|35.8495145|0.9536491693812428|I love Yoda so much\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.9381788967926521|The world is completely fucked  99%  completely fucked..But what are we without our fantasies of causes  heroes  and grand battles.\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.6512862750937641|@toogucciforyou someone's keeping me up ??\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.8849331055255223|@toogucciforyou Aflanne that's why ma bjarreb ektob Swedish?\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.8364178901299960|Creativity is where you find who you are!\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.6532908315602334|@KrewdPoet all the better id say\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.4084283943748655|Putin Lists U.S. As One Of The Threats To Russia's National Security https://t.co/jd93Drk4N2 https://t.co/l7LKUN4A5C\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.7771673205629203|A Clip on projector  WiGig and LTE all into a single lightweight Lenovo ThinkPad X1 Tablet. WoW! @lenovo  https://t.co/A32Q9RSl6A via @CNET\t|\r\n|33.8733655|35.8495145|0.9596987698902406|@Gulan_A thank you. I wish you all the best too\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.2695436743946154|AFP: Saudi police shot at in home village of executed cleric\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.2694895125816703|Which Countries Are the Most Expensive for Tourists? https://t.co/hgzR6kPIMH https://t.co/lQJHkFyq24\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.8311372110468187|Good Morning !????\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.1222478140991693|How do some not even feel the tiniest bit sorry for what they put others through? Curious\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.7039707972753375|@JoumanaGebara @JosephLF @alhayat_ksa joke of the day...\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.0709410869696622|With laws preventing me from smoking while there are kids in the car  this will be me as a parent https://t.co/wwa2XiOaVW\t\t\t\t\t\t\t\t\t\t|\r\n|33.8733655|35.8495145|0.1955959507977803|ok im gonna go back to sleep now\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n```\r\n\r\nYou can download the file with 1000 complete rows from the [downloads section](#downloads).\r\n\r\n#### Sentiment across Europe\r\n\r\nI collected tweets geo-localised in Europe created between 2015-12-26 and 2016-12-04. I ran them through the sentiment analyser, and this is the result:\r\n\r\n![Happiness Levels in Europe](https://raw.githubusercontent.com/Aluxian/Tweeather/master/docs/happiness.gif)\r\n\r\nThe change in the number of data points seems to depend more on the time of day than on weather conditions. In order to draw a pertinent conclusion about the correlation between weather conditions and sentiment, a larger dataset of tweets is required (spread across more than just a week).\r\n\r\n### 3. *Fire* scripts\r\n\r\nI used these scripts to train an [artificial neural network][5] that predicted the sentiment polarity given 3 weather variables: temperature, pressure and humidity.\r\n\r\n#### Collection\r\n\r\nTweets were collected using Twitter's Streaming API, filtered by location (Europe) and language (English).\r\n\r\n#### Processing\r\n\r\nAfter they were collected, tweets were ran through the sentiment analyser to get their polarity. The parser script used a [NOAA][4]-provided weather dataset to extract the temperature, pressure and humidity for each tweet's location.\r\n\r\n#### Training\r\n\r\nAfter processing the tweets, I used them to train a [multilayer perceptron][9]. The 3 weather variables were the input nodes and the polarity was the output node. 90% of the dataset was used for training and the remaining 10% for testing.\r\n\r\n#### Running\r\n\r\nTo run the experiment:\r\n\r\n```\r\n# Collect tweets; leave this running for a few hours\r\n$ sbt submit-TwitterHoseFireCollector\r\n\r\n# Parse the collected tweets\r\n# This parser uses the \"emo\" sentiment analyser, make sure\r\n#   you've trained it first or edit the script to use the other model\r\n$ sbt submit-TwitterHoseFireParser\r\n\r\n# Train the sentiment analyser\r\n$ sbt submit-TwitterHoseFireTrainer\r\n\r\n# Test the analyser\r\n$ sbt submit-TwitterHoseFireRepl\r\n```\r\n\r\n#### Screenshot\r\n\r\nHere's a screenshot of my collector running for almost 9 days.\r\n\r\n![Fire Collector](https://raw.githubusercontent.com/Aluxian/Tweeather/master/docs/ss-fire-collector.png)\r\n\r\n## Conclusion\r\n\r\n> TODO\r\n\r\n## Tips\r\n\r\nKeep these in mind:\r\n\r\n- use a powerful machine (otherwise, a cluster might be required)\r\n- use the Spark UI to watch your script's progress on [http://localhost:4040](http://localhost:4040)\r\n- you can download my trained models from the [downloads section](#downloads); just place them where the trainers would save them (see the scripts' source code) and you're good to go\r\n\r\n## Suggestions\r\n\r\nA few suggestions to improve the project:\r\n\r\n- The sentiment analyser doesn't recognise negated words. Sentences like \"i am not happy\" are incorrectly classified as positive. Use a POS-tagger to merge words with their negations before using them for training (e.g. that sentence would become \"i am not_happy\")\r\n- Use fuzzy matching with an English dictionary to correct spelling mistakes and further reduce the feature space\r\n- *Other suggestions are welcome!*\r\n\r\n## Downloads\r\n\r\nI uploaded some files from my project on the [releases page][13]:\r\n\r\n- [happiness.csv][10] – a csv with `lat`, `lon` and `polarity` describing locations and their sentiment\r\n- [model-sentiment-140.tar.gz][11] – my Sentiment140 sentiment analyser model\r\n- [model-emo-140.tar.gz][12] – my emo sentiment analyser model\r\n- [examples-sentiment-140.txt][14] – prediction examples done with the Sentiment140 analyser\r\n- [examples-emo-140.txt][15] – prediction examples done with the emo analyser\r\n\r\n\r\n[1]: http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0138717\r\n[2]: http://help.sentiment140.com/for-students/\r\n[3]: https://dev.twitter.com/streaming/overview\r\n[4]: http://www.noaa.gov/\r\n[5]: https://www.wikiwand.com/en/Artificial_neural_network\r\n[6]: http://spark.apache.org/\r\n[7]: http://www.scala-sbt.org/\r\n[8]: https://hadoop.apache.org/\r\n[9]: https://en.wikipedia.org/wiki/Multilayer_perceptron\r\n[10]: https://github.com/Aluxian/Tweeather/releases/download/v1/happiness.csv\r\n[11]: https://github.com/Aluxian/Tweeather/releases/download/v1/model-sentiment-140.tar.gz\r\n[12]: https://github.com/Aluxian/Tweeather/releases/download/v1/model-emo-140.tar.gz\r\n[13]: https://github.com/Aluxian/Tweeather/releases/latest\r\n[14]: https://github.com/Aluxian/Tweeather/releases/download/v1/examples-sentiment-140.txt\r\n[15]: https://github.com/Aluxian/Tweeather/releases/download/v1/examples-emo-140.txt\r\n","google":"UA-45600261-9","note":"Don't delete this file! It's used internally to help with page regeneration."}